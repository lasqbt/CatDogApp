<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.css">
		<link rel="stylesheet" href="../css/messageIndex.css">
		<link type="text/css" rel="stylesheet" href="../css/headerCss.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<script type="text/javascript" src="../js/jquery.min.js"></script>
	</head>

	<body style="background-color:transparent;margin:0px; padding:0px;">
		<div class="mainDiv" style="height:100%;width:100%;position:absolute;">

			<!--下拉刷新容器-->
			<div id="refreshContainer" class="mui-content mui-scroll-wrapper">
			  <div class="mui-scroll">
			    <!--数据列表-->
			    <ul class="mui-table-view mui-table-view-chevron" id="ulInfo">
			      
			    </ul>
			  </div>
			</div>
			
		</div>
	</body>
	<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/config.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/mui.pullToRefresh.js" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" href="../css/commonFontCss.css">
	<script>
		// 分页初始参数
		var pageNum = 1;
		var totalPage = 0;
		
		//列表上下滑动带有弹力的效果
		(function (mui) {
			mui(".mui-scroll-wrapper").scroll({
				bounce: true,//滚动条是否有弹力默认是true
				indicators: true, //是否显示滚动条,默认是true
			});
			pulluploading();
		})(mui);
		
		mui.init({ 
		 pullRefresh : {
		　　 swipeBack: false, //关闭左滑关闭功能
		    container:"#refreshContainer",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
		    down : {
		      style:'circle',//必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
		      color:'#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
		      height:'50px',//可选,默认50px.下拉刷新控件的高度,
		      range:'100px', //可选 默认100px,控件可下拉拖拽的范围
		      offset:'0px', //可选 默认0px,下拉刷新控件的起始位置
		      auto: false,//可选,默认false.首次加载自动上拉刷新一次
		      callback :pulldownRefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
		   },
		　　up:{
			   auto: false ,//可选,默认false.首次加载自动上拉加载一次
		　　　　contentrefresh: '正在加载...',
		　　　　contentnomore:'没有更多数据了',
		　　　　callback:pulluploading //上拉加载下一页
		　　},
		}
		});
		 
		 function pulluploading(){
 			 var url = path1+"/msg/getMsgDataListByPage";
			 var appSessionIdInfo = localStorage.getItem("appSessionIdInfo");
			 console.log(url);
			 mui.ajax(url, {
			     type: "get",
			     dataType: "json",
			     data:{
					 queryUserId:"",
					 page:pageNum,
					 limit:10,
					 appSessionIdInfo:appSessionIdInfo
				 },
				 success: function(data){
					 console.log(data);
					 if(data.code == 1){
						 mui.toast(data.msg);
					 }else{
						 var html = "";
						 var dataInfo = data.data;
						 var count = data.count;
						 for(var v=0; v<dataInfo.length;v++){
							 html = html + '<li class="mui-table-view-cell liCss">';
							 html = html + '<a href="" class="mui-navigate-right" style="color: #929292;font-size: 1rem;">';
							 html = html + dataInfo[v].msgInfo;
							  //将获取到的数据动态赋值给列表，假设scroller为滚动容器
							  //如果数据不到一页，显示“没有更多数据了”,关闭上拉功能
							  //scroller.endPullupToRefresh(true);
							  //scroller.querySelector(".mui-pull-bottom-pocket .mui-pull-caption").innerHTML = "没有更多数据了";
							 html = html + '</a>';
							 html = html + '</li>';
						 }
						 if(totalPage==0){
							 if(count%10==0){
								totalPage = count/10; 
							 }else{
								 totalPage = parseInt(count/10)+1
							 }
						 }
						 mui.toast(totalPage +"=="+pageNum);
						 //mui.toast(pageNum);
						 if(totalPage == pageNum){
							  mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
							  mui.toast('没有更多数据了！');
							  //mui.querySelector(".mui-pull-bottom-pocket .mui-pull-caption").innerHTML = "没有更多数据了";
						 }else{
							 mui('#refreshContainer').pullRefresh().endPullupToRefresh(false);
							 pageNum = pageNum + 1;
						 }
						 $("#ulInfo").append(html);
					 }
				 }
			 }); 
		 }
		function pulldownRefresh(){
			console.log("下拉一下");
		}
	</script>
</html>