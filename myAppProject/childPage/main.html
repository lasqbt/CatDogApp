<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script type="text/javascript" src="../js/config.js"></script>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<!--标准mui.css-->
		<link type="text/css" rel="stylesheet" href="../css/headerCss.css" />
		<link type="text/css" rel="stylesheet" href="../css/mui.css">
		<link type="text/css" rel="stylesheet" href="../css/showLoading.css" />
		<link type="text/css" rel="stylesheet" href="../css/app.css" />
		<link type="text/css"rel="stylesheet"  href="../css/mui.picker.min.css" />
		<style>
			.mui-bar-popover {
				width: 30%;
			}
			.aCss:hover{
				color: blue;
			}
			
			.mainDiv{
				background-image: url(../images/121234.png);
				top: 0;
				left: 0;
				overflow: hidden;
				zoom: 1; 
				background-color: #fff;
				background-repeat: no-repeat;
				background-size: cover;
				-webkit-background-size: cover;
				-o-background-size: cover;
				background-position: center 0; */
			}
			
			.mui-badge1{
				padding:0px; 
				width:65%; 
				float:right; 
				line-height:42px; 
				font-size:14px;
			}
			.lableCss{
				color: #929292;
			}
			.mui-table-view-cell:after{	
			    background-color: transparent; /*ul的背景颜色*/
			}
			.mui-table-view:after{
			    background-color: transparent; /*ul最下面的横线  liu aishen*/
			}
			.mui-table-view:before{
			    background-color: transparent; /*ul最上面的横线  liu aishen*/
			}
			.mui-input-group::after{
				background-color: transparent;
			}
			.mui-input-group::before{
				background-color: transparent;
			}
			.liCss{
				background-color:rgba(39,40,34,0.2);
				border-radius: 5px;
				width: 96%;
				margin: 0 auto;
				/* border: 1px solid #929292; */
				margin-top: 2px;
			}
			input{
				color: #929292;
			}
			input::-webkit-input-placeholder{
			    color:#929292;
			}
			input::-moz-placeholder{   /* Mozilla Firefox 19+ */
			    color:#929292;
			}
			input:-moz-placeholder{    /* Mozilla Firefox 4 to 18 */
			    color:#929292;
			}
			input:-ms-input-placeholder{  /* Internet Explorer 10-11 */
			    color:#929292;
			}
			
			.msgSpanCss{
				border: 1px solid yellow;
			}
			
		</style>
	</head>
	<body style="margin:0px; padding:0px;">
		<div class="mainDiv" style="height:100%;width:100%;position:absolute;z-index: -999999999;">				
		
<!-- 			<div class="mui-content" style="height: 93%;z-index: -111;margin-top: 1px;background: none;">
				<iframe id="iframeInfo" src="" frameborder="0" scrolling="auto" allowtransparency="true" width="100%" height="100%" ></iframe>
			</div> -->
	<!-- 		<nav class="mui-bar mui-bar-tab ">
				<a class="mui-tab-item mui-icon mui-icon-gear aCss" style="font-size: 1rem;" href="#Popover_0">检修</a>
				<a class="mui-tab-item mui-icon mui-icon-compose aCss" style="font-size: 1rem;" href="#Popover_1">运用</a>
				<a class="mui-tab-item mui-icon mui-icon-bars aCss" style="font-size: 1rem;" href="#Popover_2">档案</a>
				<a class="mui-tab-item mui-icon mui-icon-email aCss" style="font-size: 1rem;" href="#Popover_3">消息</a>
				<a class="mui-tab-item mui-icon mui-icon-contact aCss" style="font-size: 1rem;" href="#Popover_4">我的</a>
			</nav> -->
			<nav class="mui-bar mui-bar-tab " id="navDiv" style="background:none;border: none;height: 5%;z-index: 99999999;">
				<a class="mui-tab-item aCss" style="font-size: 1rem;" id="repairInfo">
					<span class="mui-icon mui-icon-gear"></span>
					<span class="mui-tab-label">检修</span>
				</a>
				<a class="mui-tab-item aCss" style="font-size: 1rem;" id="yunYongInfo">
					<span class="mui-icon mui-icon-compose"></span>
					<span class="mui-tab-label">运用</span>
				</a>
				<a class="mui-tab-item aCss" style="font-size: 1rem;" id="danAnInfo">
					<span class="mui-icon mui-icon-bars"></span>
					<span class="mui-tab-label">档案</span>
				</a>
				<a class="mui-tab-item aCss" style="font-size: 1rem;" id="msgManager">
					<span class="mui-icon mui-icon-email"><span class="mui-badge" id="countMsg" style="display: none;"></span></span>
					<span class="mui-tab-label">消息</span>
				</a>
				<a class="mui-tab-item aCss" style="font-size: 1rem;" id="baseInfo">
					<span class="mui-icon mui-icon-contact"></span>
					<span class="mui-tab-label">我的</span>
				</a>
			</nav>
			<!-- <div id="Popover_0" class="mui-popover mui-bar-popover" style="background:none;border: 1px solid #007AFF;width: 108px;border-radius: 15px;">
				<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view" style="background:none;border: none;">
					<li class="mui-table-view-cell"><a href="#" id="dayRepair" style="color: #007AFF;">日常检修</a>
					</li>
					<li class="mui-table-view-cell"><a href="#" id="dingQiRepair" style="color: #007AFF;">定期检修</a>
					</li>
					<li class="mui-table-view-cell"><a href="#" id="yearRepair" style="color: #007AFF;">年度检修</a>
					</li>
				</ul>
			</div> -->
			
			<!-- 检修div start -->
			<div class="mainDiv" style="height:93%;width:100%;position:absolute;display: none;" id="repairDiv">
				<header style="width: 100%;height: 4%;z-index: 99999999;">
					<span class="us_uer4" onclick="mui.back();"></span>
					<div class="fontCss">
						<span class="fontSpanCss">检修管理</span>
					</div>
					<div class="title"></div>
				</header>
				<div class="liCss">
					
				</div>
			</div>
			<!-- 检修div end -->
			
			<!-- 运用div start -->
			<div class="mainDiv" style="height:93%;width:100%;position:absolute;display: none;" id="yunYongDiv">
				<header style="width: 100%;height: 4%;z-index: 99999999;">
					<span class="us_uer4" onclick="mui.back();"></span>
					<div class="fontCss">
						<span class="fontSpanCss">运用管理</span>
					</div>
					<div class="title"></div>
				</header>
				<div class="liCss">
					
				</div>
			</div>
			<!-- 运用div end -->
			
			<!-- 档案div start -->
			<div class="mainDiv" style="height:93%;width:100%;position:absolute;display: none;" id="dangAnDiv">
				<header style="width: 100%;height: 4%;z-index: 99999999;">
					<span class="us_uer4" onclick="mui.back();"></span>
					<div class="fontCss">
						<span class="fontSpanCss">档案管理</span>
					</div>
					<div class="title"></div>
				</header>
				<div class="liCss">
					
				</div>
			</div>
			<!-- 档案div end -->
			
			<!-- 消息div start -->
			<div class="mainDiv" style="height:93%;width:100%;position:absolute;display: none;" id="msgDiv">
				<header style="width: 100%;height: 4%;z-index: 99999999;">
					<span class="us_uer4" onclick="mui.back();"></span>
					<div class="fontCss">
						<span class="fontSpanCss">消息管理</span>
					</div>
					<div class="title"></div>
				</header>
				<div class="liCss" style="height: 24%;">
					<div class="mui-input-row">
						<label class="lableCss">消息类型</label>
						<a class="mui-navigate-right">
							<span class="mui-badge1">
								<select class="mui-h5" id="queryUserFlag" style="margin:auto;border-radius: 5px;background-color: transparent;">
									<option value="">我发送的和我接收的</option>
									<option value="2">我发送的</option>
									<option value="3">我接收的</option>
								</select>
							</span>
						</a>
					</div> 
					<div class="mui-input-row">
						<label class="lableCss">开始时间</label>
						<input readonly="readonly" type="text" value="" id="start_date" placeholder="请选择开始时间">  
					</div>  
					<div class="mui-input-row">  
						<label class="lableCss">结束时间</label>
						<input readonly="readonly" type="text" value="" id="end_date" placeholder="请选择结束时间">  
					</div> 
					<div class="mui-input-row">
						<label class="lableCss">是否已读</label>
						<select class="mui-h5" id="isRead" style="float: left; width: 100px;margin:auto;border-radius: 5px;background-color: transparent;">
							<option value="">全部</option>
							<option value="1">已读</option>
							<option value="0">未读</option>
						</select>
					</div> 
					<div style="float: right;margin-top: -40px;margin-right: 5px;">
						<button type="button" id="search" class="mui-btn mui-btn-primary mui-icon mui-icon-search">
							搜索
						</button>
						&nbsp;
						<button type="button" id="add" class="mui-btn mui-btn-success mui-icon mui-icon-plus">
							添加
						</button>
					</div>
				</div>
				<ul class="mui-table-view mui-table-view-chevron"  style="background:none;border-bottom: none;">
					<li class="mui-table-view-cell liCss" style="height: 4%;">
						<div class="mui-slider-handle" style="background:none;width:370px">
							<table style="text-align: center;width: 96%;">
								<tr>
									<td style="width: 25%;">消息</td>
									<td style="width: 25%;">发送</td>
									<td style="width: 25%;">接收</td>
									<td style="width: 25%;">时间</td>
								</tr>
							</table>
						</div>
					</li>
				</ul>
				<div id="refreshContainer" class="mui-content mui-scroll-wrapper" style="height: 69%; background:none;border-bottom: none;margin-top: 238px;">
					<div class="mui-scroll">
						<ul id="ulInfo" class="mui-table-view mui-table-view-chevron"  style="height: 94%; background:none;border-bottom: none;">
						
						</ul>
					</div>
				</div>
			</div>
			<!-- 消息div end -->
			
			<!-- 我的div start -->
			<div class="mainDiv" style="height:93%;width:100%;position:absolute;display: none;" id="myDiv">
				<header style="width: 100%;height: 4%;z-index: 99999999;">
					<span class="us_uer4" onclick="mui.back();"></span>
					<div class="fontCss">
						<span class="fontSpanCss">我的</span>
					</div>
					<div class="title"></div>
				</header>
				<div class="liCss">
					
				</div>
			</div>
			<!-- 我的div end -->
			
		</div>
	</body>
	<script src="../js/mui.min.js" type="text/javascript"></script>
	<script src="../js/mui.enterfocus.js" type="text/javascript"></script>
	<script src="../js/app.js" type="text/javascript"></script>
	<script src="../js/common.js" type="text/javascript"></script>
	<script src="../js/mui.pullToRefresh.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/commonUtils.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/showLoading.js"type="text/javascript" ></script>
	<script src="../js/mui.picker.min.js"type="text/javascript" ></script>
	<script>	
		// 分页初始参数
		var pageNum = 1;
		var totalPage = 0;
		var limit = 10;
		
		var msgIsQuery = false;
		
		(function (mui) {
			//阻尼系数
			var deceleration = mui.os.ios ? 0.003 : 0.0009;
			mui(".mui-scroll-wrapper").scroll({
				bounce: true,//滚动条是否有弹力默认是true
				indicators: false, //是否显示滚动条,默认是true
				deceleration: deceleration
			});
			/* mui.init({
				subpages: [{  
						url: '../childPage/messageIndex.html',//子页面HTML地址，支持本地地址和网络地址  
						id: '11111111', //子页面标志  
						styles: {  
							top:'45px', //mui标题栏默认高度为45px
							bottom:'50px',//子页面底部位置  
							},  
					  }]
			}); */
			mui.plusReady(function() {
				mui.ajaxSettings = mui.extend(mui.ajaxSettings, {
				    xhr: function(settings) {
				        if (settings.crossDomain) { //强制使用plus跨域
				            return new plus.net.XMLHttpRequest();
				        }
				        if (mui.os.ios && window.webkit && window.webkit.messageHandlers) { //wkwebview下同样使用5+ xhr
				            return new plus.net.XMLHttpRequest();
				        }
				        return new window.XMLHttpRequest();
							
				    }
							
				});
				var userid = JSON.parse(localStorage.getItem("userInfo")).userid;
				/****消息推送  start****/
				var socket;
				if (typeof (WebSocket) == "undefined") {
				    layer.msg("遗憾：您的手机不支持WebSocket");
				} else {
				    console.log("恭喜：您的手机支持WebSocket");
				    //实现化WebSocket对象
				    //指定要连接的服务器地址与端口建立连接
				    //注意ws、wss使用不同的端口。我使用自签名的证书测试，
				    //无法使用wss，浏览器打开WebSocket时报错
				    //ws对应http、wss对应https。
				    socket = new WebSocket("ws://172.20.19.12:8086/websocket/"+userid);
				    //连接打开事件
				    socket.onopen = function() {
				        console.log("Socket 已打开");
				        socket.send("向后台发消息==这是来自客户端的消息");
				    };
				    //收到消息事件
				    socket.onmessage = function(msg) {
				        var d = msg.data;
						if(d!=null && d!=''){
							getMsgInfo(1,1,limit);
						}
				        
				    };
				    //连接关闭事件
				    socket.onclose = function() {
				        console.log("Socket已关闭");
				    };
				    //发生了错误事件
				    socket.onerror = function() {
				        alert("Socket发生了错误");
				    }
					
				    //窗口关闭时，关闭连接
				    //jquery1.8中已经被废弃，3.0中已经移除
				    window.unload=function() {
				        socket.close();
				    };
				}
				
				
				//获取推送通知
/* 				plus.push.addEventListener("receive", function (msg) {
				   alert("接收到的透传推送 " + JSON.stringify(msg));
				   if (plus.os.name == "iOS") {
				       switch (msg.payload) {
				         case "LocalMSG":
				            alert("本地创建消息的 " + JSON.stringify(msg));
				            break;
				         default:
				         //测试本地推送
				         createLocalPushMsg(msg);
				         break;
				       }
				   }
				}, false);
				
				//创建本地消息
				function createLocalPushMsg(msg) {
				   var options = {cover: false};
				   plus.push.createMessage("1111", "LocalMSG", options);
				   if (plus.os.name == "iOS") {
				      outLine('*如果无法创建消息，请到"设置"->"通知"中配置应用在通知中心显示!');
				   }
				} */
				
				/****消息推送  end****/
				
				//正确代码
				/* $('#msgManager').on('tap', function() {  
					mui.alert("我被点了");
				}) */	
				document.getElementById("msgManager").addEventListener('tap', function() {
					document.getElementById("msgDiv").style.display='block';
					document.getElementById("repairDiv").style.display='none';
					document.getElementById("yunYongDiv").style.display='none';
					document.getElementById("dangAnDiv").style.display='none';
					document.getElementById("myDiv").style.display='none';
					//$("#iframeInfo").attr("src","../childPage/messageIndex.html");
				});
				document.getElementById("baseInfo").addEventListener('tap', function() {
					document.getElementById("myDiv").style.display='block';
					document.getElementById("repairDiv").style.display='none';
					document.getElementById("yunYongDiv").style.display='none';
					document.getElementById("dangAnDiv").style.display='none';
					document.getElementById("msgDiv").style.display='none';
					//$("#iframeInfo").attr("src","../childPage/messageIndex3.html");
				});
				document.getElementById("yunYongInfo").addEventListener('tap', function() {
					document.getElementById("yunYongDiv").style.display='block';
					document.getElementById("repairDiv").style.display='none';
					document.getElementById("myDiv").style.display='none';
					document.getElementById("dangAnDiv").style.display='none';
					document.getElementById("msgDiv").style.display='none';
					//$("#iframeInfo").attr("src","../childPage/messageIndex2.html");
				});
				document.getElementById("danAnInfo").addEventListener('tap', function() {
					document.getElementById("dangAnDiv").style.display='block';
					document.getElementById("myDiv").style.display='none';
					document.getElementById("repairDiv").style.display='none';
					document.getElementById("msgDiv").style.display='none';
					document.getElementById("yunYongDiv").style.display='none';
					//$("#iframeInfo").attr("src","../childPage/messageIndex2.html");
				});
				
				document.getElementById("repairInfo").addEventListener('tap', function() {
					document.getElementById("repairDiv").style.display='block';
					document.getElementById("yunYongDiv").style.display='none';
					document.getElementById("myDiv").style.display='none';
					document.getElementById("dangAnDiv").style.display='none';
					document.getElementById("msgDiv").style.display='none';
					//$("#iframeInfo").attr("src","../childPage/messageIndex2.html");
				});
				
				/********消息管理部分的js start*******/
				
				document.getElementById("start_date").addEventListener('tap', function() {
					var _self = this;
					if(_self.picker) {
						_self.picker.show(function (rs) {
							$("#start_date").val(rs.text+":00");
							_self.picker.dispose();
							_self.picker = null;
						});
					} else {
						var optionsJson = this.getAttribute('data-options') || '{}';
						var options = JSON.parse(optionsJson);
						var id = this.getAttribute('id');
						_self.picker = new mui.DtPicker(options);
						_self.picker.show(function(rs) {
							$("#start_date").val(rs.text+":00");
							_self.picker.dispose();
							_self.picker = null;
						});
					}
					
				}, false);
				document.getElementById("end_date").addEventListener('tap', function() {
					var _self = this;
					if(_self.picker) {
						_self.picker.show(function (rs) {
							$("#end_date").val(rs.text+":00");
							_self.picker.dispose();
							_self.picker = null;
						});
					} else {
						var optionsJson = this.getAttribute('data-options') || '{}';
						var options = JSON.parse(optionsJson);
						var id = this.getAttribute('id');
						_self.picker = new mui.DtPicker(options);
						_self.picker.show(function(rs) {
							$("#end_date").val(rs.text+":00");
							_self.picker.dispose();
							_self.picker = null;
						});
					}
					
				}, false);
				/* 			//日期选择  另外一种时间选择控件
				document.getElementById("start_date").addEventListener('tap',function() {
					getDate('start_date');
				});
				document.getElementById("end_date").addEventListener('tap',function() {
					getDate('end_date');
				});
				//获取文本框中的值
				var start_date = $('#start_date').val();
				var end_date = $('#end_date').val();
				//日期js控件
				function getDate(obj) {
					var dDate = new Date();
					//设置当前日期（不设置默认当前日期）
					dDate.setFullYear(dDate.getFullYear(), dDate.getMonth(), dDate.getDate());
					var minDate = new Date();
					//最小时间
					minDate.setFullYear(1900, 0, 1);
					var maxDate = new Date();
					//最大时间
					maxDate.setFullYear(3000, 12, 31);
					plus.nativeUI.pickDate(function(e) {
						var d = e.date;
						var objData = d.getFullYear() + "-" + (d.getMonth() < 9 ? '0': '') + (d.getMonth() + 1) + "-" + (d.getDate() < 10 ? '0': '') + d.getDate();
						pickTime(obj, objData);
					},
					function(e) {
						console.log("您没有选择日期");
					},
					{
						title: '请选择日期',
						date: dDate,
						minDate: minDate,
						maxDate: maxDate
					});
				}
				function pickTime(obj, objData) {
					plus.nativeUI.pickTime(function(e) {
						var d = e.date;
						console.log("选择的时间：" + d.getHours() + ":" + d.getMinutes());
						document.getElementById(obj).value = objData + " " + (d.getHours() < 10 ? '0': '') + d.getHours() + ":" + (d.getMinutes() < 10 ? '0': '') + d.getMinutes() + ":" + (d.getSeconds() < 10 ? '0': '') + d.getSeconds();
				
					},
					function(e) {
						console.log("未选择时间：" + e.message);
					});
				} */
				
				mui.init({ 
			     swipeBack: false,
				 pullRefresh : {
					container:"#refreshContainer",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
					/* down : {
					  height:'50px',//可选,默认50px.下拉刷新控件的高度,
					  auto: false,//可选,默认false.首次加载自动上拉刷新一次
					  contentdown : "下拉可以刷新呀",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
					  contentover : "释放立即刷新哟",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
					  contentrefresh : "正在刷新ing...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容 
					  contentnomore:'刷新完成了',
					  callback :pulldownRefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
				   }, */
				　　up:{
					   auto: true ,//可选,默认false.首次加载自动上拉加载一次
				　　　　contentrefresh: '正在加载中...',
				　　　　contentnomore:'没有更多数据了',
				　　　　callback:pulluploading//上拉加载下一页
				　　}
				}
				});
				
				
				 function pulldownRefresh(){
				 	console.log("消息管理之下拉刷新");
				 	if(msgIsQuery){
				 		getMsgInfo(0,1,totalPage*limit);			 
				 	}else{
				 		getMsgInfo(0,pageNum,limit);
				 	}
				 }
				 
				 function pulluploading(){
					 console.log("消息管理之上拉加载数据"+msgIsQuery);
					 if(msgIsQuery){
						getMsgInfo(0,pageNum,limit);			 
					 }else{
				 		getMsgInfo(0,pageNum,limit);
				 	}
				 }
				
				//监听自定义事件，用于子页面向父页面进行传值  子页面：jieShouRen.html
				window.addEventListener("sendMsgAfterQueryInfo", function(e) {
					console.log("发送完毕信息后，触发主页面的信息管理页面刷新操作");
					setTimeout(function(){
						//执行新的查询操作
						getMsgInfo(1,1,limit);
					}, 800);
				});
				
				//监听自定义事件，用于子页面向父页面进行传值  子页面：messageDetail.html
				window.addEventListener("updateNoReadMsgCount", function(e) {
					console.log("阅读一条消息后修改app图标上数字和app内页面上的消息总数数字");
					setTimeout(function(){
						getMsgInfo(1,1,limit);
						var count = parseInt(e.detail.noReadMsgCount);
						setRedNum(count);
					}, 300);
				});
				
				//搜索
				document.getElementById("search").addEventListener('tap',function() {
					console.log("消息管理之搜索查询");
					totalPage = 0;
					getMsgInfo(1,1,limit);
				});
				
				function getMsgInfo(flag,pageNumV,limitV){
					var isRead = $("#isRead").val();
					var queryUserFlag = $("#queryUserFlag").val();
					var startTime = $("#start_date").val();
					var endTime = $("#end_date").val();
					//console.log(isRead+"="+queryUserFlag+"="+startTime+"="+endTime);
					var url = path1+"/msg/getMsgDataListByPage";
					var appSessionIdInfo = localStorage.getItem("appSessionIdInfo");
					var uid = JSON.parse(localStorage.getItem("userInfo")).userid;
					if(flag == 1){
						//显示遮罩层
						mui.showLoading("查询中,请稍后...","div");
						// 重新激活上拉加载 下拉刷新操作
						mui('#refreshContainer').pullRefresh().refresh(true);
					}
					mui.ajax(url, {
						 type: "get",
						 dataType: "json",
						 data:{
							 isRead:isRead,
							 queryUserFlag:queryUserFlag,
							 startTime:startTime,
							 endTime:endTime,
							 page:pageNumV,
							 limit:limitV,
							 appSessionIdInfo:appSessionIdInfo
						 },
						 success: function(data){
							 if(flag == 1){
								 //关闭遮罩层
								mui.hideLoading();
								// 清空操作
								$("#ulInfo").empty();
							 }else{
								 msgIsQuery = true;
							 }
							 if(data.code == 1){
								 mui.toast(data.msg);
							 }else{
								 var html = "";
								 var dataInfo = data.data;
								 var count = data.count;
								 for(var v=0; v<dataInfo.length;v++){
									 html = html + '<li class="mui-table-view-cell liCss" id='+dataInfo[v].id+'>';
									 // 向右滑删除
									 //html = html + '<div class="mui-slider-left mui-disabled"><a class="mui-btn mui-btn-red">删除</a></div>';
									 // 向左滑删除
									 html = html + '<div class="mui-slider-right mui-disabled"><a class="mui-btn mui-btn-red">删除</a></div>';
									 html = html + '<div class="mui-slider-handle" style="background:none;width:380px">';
									 if(dataInfo[v].isRead == 0 && dataInfo[v].userTo == uid){//未读 并且发送人是当前登录账号
										 html = html + '<a href="javascript:void(0)" class="mui-navigate-right" style="color: blue;font-size: 1rem;">';
									 }else{//已读
										 html = html + '<a href="javascript:void(0)" class="mui-navigate-right" style="color: #929292;font-size: 1rem;">';
									 }
									 html = html + '<table style="width: 96%;text-align: center;"><tr>';
									 if(dataInfo[v].msgInfo.length>3){
										 html = html + "<td style='width:25%;'>"+dataInfo[v].msgInfo.substring(0,3)+"...</td>";
									 }else{
										 html = html + "<td style='width:25%;'>"+dataInfo[v].msgInfo+"<td>";
									 }
									 if(dataInfo[v].userNameFrom.length>3){
										html = html + "<td style='width:25%;'>"+dataInfo[v].userNameFrom.substring(0,3)+"...</td>";
									 }else{
										html = html + "<td style='width:25%;'>"+dataInfo[v].userNameFrom+"</td>";
									 }
									 if(dataInfo[v].userNameTo.length>3){
										html = html + "<td style='width:25%;'>"+dataInfo[v].userNameTo.substring(0,3)+"...</td>";
									 }else{
										html = html + "<td style='width:25%;'>"+dataInfo[v].userNameTo+"</td>";
									 } 
									 html = html + "<td style='width:25%;'>"+Format(dataInfo[v].createTime,"yyyy-MM-dd")+"</td>";
									 html = html + '</a></div>';
									 html = html + '</tr></table></a></div>';
									 html = html + '</li>';
								 }
								 if(totalPage==0){
									 if(count%limit==0){
										totalPage = count/limit; 
									 }else{
										 totalPage = parseInt(count/limit)+1
									 }
								 }
								 //mui.toast(totalPage +"=="+pageNumV);
								 if(totalPage == pageNumV){
									  mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
									  //mui.toast('没有更多数据了！');
									  //mui.querySelector(".mui-pull-bottom-pocket .mui-pull-caption").innerHTML = "没有更多数据了";
										pageNum = 1;
								 }else{
									 mui('#refreshContainer').pullRefresh().endPullupToRefresh(false);
									 if(flag!=1){
										pageNum = pageNum + 1; 
									 }
								 }
								 $("#ulInfo").append(html);
								 if(flag==1){
									 mui('#refreshContainer').pullRefresh().scrollTo(1, 1, 100); 
								 }
								 setRedNum(data.noReadMsgCount);
							 }
						 }
					}); 
				}
				
				
				//发送消息
				document.getElementById("add").addEventListener('tap',function() {
					var id = generateUUID()+"-messageAdd";
					mui.openWindow({
						url: '../childPage/messageAdd.html',
						id: id,
						show: {
							aniShow: 'pop-in'
						},
						styles: {
							popGesture: 'hide'
						},
						waiting: {
							autoShow: false
						},
						createNew:true
					});
				});
						
				mui('#ulInfo').on('tap','li',function(v){
					  var msgId = this.id;
					  console.log("点击的信息主键ID："+msgId);
					  var id = generateUUID()+"-messageDetail";
					  mui.openWindow({
						url: '../childPage/messageDetail.html',
						id: id,
						show: {
							aniShow: 'pop-in'
						},
						styles: {
							popGesture: 'hide'
						},
						waiting: {
							autoShow: false
						},
						extras: {
							msgId: msgId
						},
						createNew:true
					  });
				})
				
				
				var btnArray = ['确认', '取消'];
				////右滑不需要点击删除自动触发弹出确认框
				//$('#ulInfo').on('slideleft', '.mui-table-view-cell', function(event) {
				//右滑点击删除弹出确认框
				$('#ulInfo').on('tap', '.mui-btn', function(event) {
					var elem = this;
					var li = elem.parentNode.parentNode;
					mui.confirm('确认删除该条记录？', '提示', btnArray, function(e) {
						if (e.index == 0) {
							li.parentNode.removeChild(li);
							var id = parseInt(li.id);
							var url = path1+"/msg/getMsgInfoById";
							var appSessionIdInfo = localStorage.getItem("appSessionIdInfo");
							mui.showLoading("删除中,请稍后...","div"); 
							mui.ajax(path1+'/msg/deleteMsgById',{
								data:{
										 appSessionIdInfo:appSessionIdInfo,
										 id:id
									},
								async:true,
								dataType:'json',   
								type:'post',
								success:function(data){
									mui.hideLoading();
									mui.toast(data.msg);
									getMsgInfo(1,1,limit);
								},
								error:function(data){
									mui.alert('请求失败');
								}
							}); 
						} else {
							setTimeout(function() {
								$.swipeoutClose(li);
							}, 0);
						}
					});
				});
				/********消息管理部分的js end*******/
			});
		})(mui);
	</script>
</html>